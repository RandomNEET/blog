---
title: Safely declare system config
published: 2025-10-30
description: Avoid storing secrets in NixOS config
tags: [Daily, NixOS]
category: Daily
draft: false
---

# Using external config file

This is the simplest way — just point the config option to the actual config file path. For example:

```nix
{ ... }:
{
  services.<name> = {
    enable = true;
    settingsFile = "/path/to/config.json";
  };
}
```

Make sure the service has sufficient permission to access the config file.
Check the systemd service user and group information with: `systemctl show <name> | grep -E 'User|Group'`

# Using environment file

Some programs can directly read environment variables, while others can use variables defined in an environment file to replace sensitive values in configuration files.

## Programs that use environment variables for configuration

Create an environment file containing all necessary variables:

```shell
ADMIN_TOKEN='p4ssw0rd'
SMTP_FROM=admin@example.com
SMTP_FROM_NAME=idk
SMTP_HOST=127.0.0.1
SMTP_PORT=25
SMTP_USERNAME=admin@example.com
SMTP_PASSWORD="dr0wss4p"
```

Then, specify the path to this environment file in service configuration:

```nix
{ ... }:
{
  services.<name> = {
    enable = true;
    environmentFile = "/var/lib/<name>.env";
  };
}
```

If there is no `environmentFile` option available, add it manually via the service configuration:

```nix
{ ... }:
{
  services.<name> = {
    enable = true;
  };
  systemd.services.<name>.serviceConfig = {
    EnvironmentFile = "/var/lib/<name>.env";
  };
}
```

## Programs that expand environment variables in config files

Define all required variables in an environment file, according to the program’s documentation:

```shell
HOMEPAGE_VAR_JELLYFIN_KEY=keykeykey
HOMEPAGE_VAR_CALIBRE_USERNAME=idk
HOMEPAGE_VAR_CALIBRE_PASSWORD=w0rdp4ss
```

Then, reference these variables within your actual configuration:

```nix
{ ... }:
{
  services.homepage-dashboard = {
    enable = true;
    environmentFile = "/var/lib/<name>.env";
    settings = {
      services = [
        {
          "Media" = [
            {
              "Jellyfin" = {
                href = "http://192.168.0.69:8096/";
                widget = {
                  type = "jellyfin";
                  url = "http://127.0.0.1:8096";
                  key = "{{HOMEPAGE_VAR_JELLYFIN_KEY}}";
                  enableBlocks = true;
                  enableNowPlaying = false;
                  enableUser = true;
                  showEpisodeNumber = true;
                  expandOneStreamToTwoRows = false;
                };
                icon = "jellyfin";
              };
            }
            {
              "Calibre" = {
                href = "https://calibre.example.com/";
                widget = {
                  type = "calibreweb";
                  url = "http://127.0.0.1:6969";
                  username = "{{HOMEPAGE_VAR_CALIBRE_USERNAME}}";
                  password = "{{HOMEPAGE_VAR_CALIBRE_PASSWORD}}";
                };
                icon = "calibre";
              };
            }
          ];
        }
      ];
    };
  };
}
```

If the service definition doesn’t provide an `environmentFile` option, add it manually:

```nix
{ ... }:
{
  services.homepage-dashboard = {
    enable = true;
    settings = {
      services = [
        {
          "Media" = [
            {
              "Jellyfin" = {
                href = "http://192.168.0.69:8096/";
                widget = {
                  type = "jellyfin";
                  url = "http://127.0.0.1:8096";
                  key = "{{HOMEPAGE_VAR_JELLYFIN_KEY}}";
                  enableBlocks = true;
                  enableNowPlaying = false;
                  enableUser = true;
                  showEpisodeNumber = true;
                  expandOneStreamToTwoRows = false;
                };
                icon = "jellyfin";
              };
            }
            {
              "Calibre" = {
                href = "http://calibre.example.com/";
                widget = {
                  type = "calibreweb";
                  url = "http://127.0.0.1:6969";
                  username = "{{HOMEPAGE_VAR_CALIBRE_USERNAME}}";
                  password = "{{HOMEPAGE_VAR_CALIBRE_PASSWORD}}";
                };
                icon = "calibre";
              };
            }
          ];
        }
      ];
    };
  };
  systemd.services.homepage-dashboard.serviceConfig = {
    EnvironmentFile = "/var/lib/<name>.env";
  };
}
```
